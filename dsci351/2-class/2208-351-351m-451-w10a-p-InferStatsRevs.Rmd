---
title: "DSCI353-353m-453: Class 10a-p Inferential Stats Review, T-test"
subtitle: "Profs: R. H. French, L. S. Bruckman, P. Leu, K. Davis, S. Cirlos"
author: "TAs: W. Oltjen, K. Hernandez, M. Li, M. Li, D. Colvin" 
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  pdf_document:
    latex_engine: xelatex
    toc: TRUE
    number_sections: TRUE
    toc_depth: 6
    highlight: tango
  html_notebook:
  html_document:
    css: ../lab.css
    highlight: pygments
    theme: cerulean
    toc: yes
    toc_depth: 6
    toc_float: yes
    df_print: paged
urlcolor: blue
always_allow_html: true
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  cache = FALSE, # if TRUE knitr will cache results to reuse in future knits
  fig.width = 6, # the width for plots created by code chunk
  fig.height = 4, # the height for plots created by code chunk
  fig.align = 'center', # how to align graphics. 'left', 'right', 'center'
  dpi = 300, 
  dev = 'png', # Makes each fig a png, and avoids plotting every data point
  # eval = FALSE, # if FALSE, then the R code chunks are not evaluated
  # results = 'asis', # knitr passes through results without reformatting
  echo = TRUE, # if FALSE knitr won't display code in chunk above it's results
  message = TRUE, # if FALSE knitr won't display messages generated by code
  strip.white = TRUE, # if FALSE knitr won't remove white spaces at beg or end of code chunk
  warning = TRUE, # if FALSE knitr won't display warning messages in the doc
  error = TRUE) # report errors
  # options(tinytex.verbose = TRUE)
```

 \setcounter{section}{10}
 \setcounter{subsection}{1}
 \setcounter{subsubsection}{2}

#### Class Readings, Assignments, Syllabus Topics

##### Reading, Lab Exercises, SemProjects

  - Readings: 
    - For today: OIS 7.1-4
    - For next class: 
  - Laboratory Exercises: 
    - LE 5: Is due Thursday November 10th  
    - LE 6: Will be posted Thursday November 10th
  - Office Hours: (Class Canvas Calendar for Zoom Link) 
    - Wednesday @ 4:00 PM to 5:00 PM, Will Oltjen
    - Saturday @ 3:00 PM to 4:00 PM, Kristen Hernandez 
    - **Office Hours are on Zoom, and recorded**
  - Semester Projects
    - DSCI 451 Students Biweekly Update #5 Due Friday Nov. 4th
    - DSCI 451 Students 
      - Next **Report Out #3 is Due November 25th **
    - All DSCI 351/351M/451 Students: 
      - **Peer Grading of Report Out #2 is Due November 8th **
    - Exams
      - Final: Monday December 19, 2022, 12:00PM - 3:00PM, Nord 356 or remote
    
##### Textbooks \

Introduction to R and Data Science

  - For R, Coding, Inferential Statistics
    - Peng: R Programming for Data Science
    - Peng: Exploratory Data Analysis with R

Textbooks for this class

  - OIS = Diez, Barr, Çetinkaya-Runde: Open Intro Stat v4
  - R4DS = Wickham, Grolemund: R for Data Science
  
Textbooks for DSCI353/353M/453, And in your Repo now

  - ISLR2 = James, Witten, Hastie, Tibshirani: Intro to Statistical Learning with R
  - ESL = Trevor Hastie, Tibshirani, Friedman: Elements of Statistical Learning
  - DLwR = Chollet, Allaire: Deep Learning with R

##### Tidyverse Cheatsheets, Functions and Reading Your Code \

Look at the Tidyverse Cheatsheet 

  - **Tidyverse For Beginners Cheatsheet**
    - In the Git/20s-dsci353-353m-453-prof/3-readings/3-CheatSheets/ folder
  - **Data Wrangling with dplyr and tidyr Cheatsheet**

  
  Tidyverse Functions & Conventions
  
    - The pipe operator `%>%`
    - Use `dplyr::filter()` to subset data row-wise.
    - Use `dplyr::arrange()`  to sort the observations in a data frame
    - Use `dplyr::mutate()` to update or create new columns of a data frame
    - Use `dplyr::summarize()` to turn many observations into a single data point
    - Use `dplyr::arrange()` to change the ordering of the rows of a data frame 
    - Use `dplyr::select()` to choose variables from a tibble, 
      - keeps only variables you mention
    - Use `dplyr::rename()` keeps all the variables and renames variables
      - rename(iris, petal_length = Petal.Length)
    - These can be combined using `dplyr::group_by()` 
      - which lets you perform operations “by group”. 
    - The `%in%` matches conditions provided by a vector using the c() function
    - The **forcats** package has tidyverse functions 
      - for factors (categorical variables)
    - The **readr** package has tidyverse functions 
      - to read_..., melt_... col_..., parse_... data and objects

Reading Your Code: Whenever you see

  - The assignment operator `<-`, think **"gets"**
  - The pipe operator, `%>%`, think **"then"**
  

##### Syllabus

![DSCI351-351M-451 Syllabus](./figs/syllabus.png)

### Inferential Statistics Review

#### Descriptive Statistics \

Here, we’ll look at measures of 

  - central tendency, 
  - variability, 
  - and distribution shape 
    - for continuous variables. 
  
For illustrative purposes, we’ll use several of the variables 

  - from the Motor Trend Car Road Tests (mtcars) dataset 
  - Our focus will be on 
    - miles per gallon (mpg), 
    - horsepower (hp), 
    - and weight (wt): 


First, we’ll look at descriptive statistics for all 32 cars. 

Then we’ll examine descriptive statistics 

  - by transmission type (am)
  - engine cylinder configuration (vs). 
  
The former is coded 

  - 0 = automatic, 
  - 1 = manual, 
  
and the later is coded 

  - 0 = V-shape and 
  - 1 = straight.

When it comes to calculating descriptive statistics, 

  - R has an embarrassment of riches. 

Let’s start with functions that are included in the base R. 

Then we’ll look at extensions that are available 

  - through the use of user-contributed packages.

In the base installation, you can use the summary() function 

  - to obtain descriptive statistics.

##### Descriptive statistics with `summary()`

```{r} 
myvars <- c("mpg", "hp", "wt")
summary(mtcars[myvars])
``` 


##### Descriptive statistics via `sapply()` \

I don't tend to use the "apply" functions that much anymore.

```{r}
mystats <- function(x, na.omit = FALSE) {
  if (na.omit)
    x <- x[!is.na(x)]
  m <- mean(x)
  n <- length(x)
  s <- sd(x)
  skew <- sum((x - m) ^ 3 / s ^ 3) / n
  kurt <- sum((x - m) ^ 4 / s ^ 4) / n - 3
  return(c(
    n = n,
    mean = m,
    stdev = s,
    skew = skew,
    kurtosis = kurt
  ))
}

myvars <- c("mpg", "hp", "wt")
sapply(mtcars[myvars], mystats)
```

##### Descriptive statistics via `describe()` in the `Hmisc` package

```{r}
library(Hmisc)
myvars <- c("mpg", "hp", "wt")
describe(mtcars[myvars])
```

##### Descriptive statistics via `stat.desc()` in the `pastecs` package 

```{r}
library(pastecs)
myvars <- c("mpg", "hp", "wt")
stat.desc(mtcars[myvars])
```

##### Descriptive statistics via `describe()` in the `psych` package

```{r}
library(psych)
myvars <- c("mpg", "hp", "wt")
describe(mtcars[myvars])
```

##### Descriptive statistics by group using `by()` \

When comparing groups of individuals or observations, 

  - the focus is usually on the descriptive statistics of each group, 
  - rather than the total sample. 
  
Group statistics can be generated using base R's `by()` function. 

  - The format is `by(data, INDICES, FUN)`
    - where data is a data frame or matrix, 
    - `INDICES` is a factor or list of factors that defines the groups, 
  - and `FUN` is an arbitrary function that operates on 
    - all the columns of a data frame. 

```{r}
dstats <- function(x)
  sapply(x, mystats)
myvars <- c("mpg", "hp", "wt")
by(mtcars[myvars], mtcars$am, dstats)
```

##### Descriptive statistics for groups defined by multiple variables \

In the next example, summary statistics are generated 

  - for two by variables (am and vs) 
  - and the results for each group are printed with custom labels. 
  
Additionally, missing values 

  - are omitted before calculating statistics.


```{r}
dstats <- function(x)
  sapply(x, mystats, na.omit = TRUE)
myvars <- c("mpg", "hp", "wt")
by(mtcars[myvars],
   list(Transmission = mtcars$am,
        Engine = mtcars$vs),
   FUN = dstats)
```


#### Summarizing data interactively with dplyr \

So far, we've focused on methods 

  - that generate a comprehensive set of descriptive statistics 
  - for a given data frame. 
  
However, in interactive, exploratory data analyses, 

  - our goal is to answer targeted questions. 
  
In this case, we'll want to obtain 

  - a limited number of statistics
  - on specific groups of observations.

The dplyr package, provides us with tools 

  - to quickly and flexibly accomplish this. 
  
The summarize(), and summarize_all() functions 

  - can be used to calculate any statistic, 
  - and the group_by() function 
    - can be used to specify the groups 
    - on which to calculate those statistics.

As a demonstration, let's ask and answer a set of questions 

  - using the Salaries data frame in the carData package. 
  
The dataset contains 2008-2009 9-month salaries in US dollars (salary) 

  - for 397 faculty members at a university in the United States. 
  
The data were collected as part of ongoing efforts 

  - to monitor salary differences 
  - between male and female faculty.


```{r message = FALSE}
library(dplyr)
library(carData)

Salaries %>%
  summarize(med = median(salary),
            min = min(salary),
            max = max(salary))
```

The Salaries dataset is passed to the summarize() function, 

  - which calculates the median, minimum and maximum value for salary 
  - and returns the result as a one row tibble (data frame). 
  
The median 9-month salary is $107,300 and 

  - at least one person was making more than $230,000. 
  -  I clearly need to ask for a raise.

What is the 

  - faculty count, 
  - median salary, 
  - and salary range 
    - by sex and rank?


```{r}
Salaries %>%
  group_by(rank, sex) %>%
  summarize(
    n = length(salary),
    med = median(salary),
    min = min(salary),
    max = max(salary)
  )
```

When categorical variables are specified in a by_group() statement, 

  - the summarize() function generates a row of statistics 
  - for each combination of their levels. 
  
Women have a lower median salary 

  - than men within each faculty rank. 

In addition, 

  - there are a very large number of male full professors 
  - at this university.


What is the mean years of service and years since Ph.D. 

  - for faculty 
  - by sex and rank?

```{r}
Salaries %>%
  group_by(rank, sex) %>%
  select(yrs.service, yrs.since.phd) %>%
  summarize_all(mean)
```

The `summarize_all()` function 

  - calculates a summary statistic for each non-grouping variable
    - (yrs.service and yrs.since.phd here). 
    
If you want more than one statistic for each variable, 

  - provide them in a list. 
  - For example, `summarize_all(list(mean = mean, std = sd))`
    - would calculate the mean and standard deviation for each variable. 
    
Men and women have comparable experience histories 

  - at the Assistant and Associate Professor levels. 
  
However, female Full Professors 

  - have fewer years of experience 
  - than their male counterparts.

One advantage of the dplyr approach is that 

  - results are returned as tibbles (data frames).

This allows you to 

  - analyze these summary results further, 
  - lot them, 
  - and reformat them for printing. 

This is taking advantage of the object oriented nature of R.
  
It also provides an easy mechanism for aggregating data.

In general, data analysts have their own preferences 

  - for which descriptive statistics to display 
  - and how they like to see them formatted. 
  
This is probably why there are many variations available. 

Choose the one that works best for you, or create your own!


### Links

Robert I. Kabacoff, R in Action, 3rd Edition, Manning Publications 2020 

 
