---
title: "CWRU DSCI351-351m-451: Rmd and For Loop Basics, (CWRU, Pitt, UCF, UTRGV)"
subtitle: "Profs: R. H. French, L. S. Bruckman, P. Leu, K. Davis, S. Cirlos"
author: "TAs: W. Oltjen, K. Hernandez, M. Li, M. Li, D. Colvin"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  pdf_document:
    latex_engine: xelatex
    toc: true
    number_sections: true
    toc_depth: 6
  html_document:
    font-size: 10em
    self_contained: yes
    toc: yes
  beamer_presentation:
    toc: yes
urlcolor: blue
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  cache = FALSE, # if TRUE knitr will cache results to reuse in future knits
  fig.width = 6, # the width for plots created by code chunk
  fig.height = 4, # the height for plots created by code chunk
  fig.align = 'center', # how to align graphics. 'left', 'right', 'center'
  dpi = 300, 
  dev = 'png', # Makes each fig a png, and avoids plotting every data point
  # eval = FALSE, # if FALSE, then the R code chunks are not evaluated
  # results = 'asis', # knitr passes through results without reformatting
  echo = TRUE, # if FALSE knitr won't display code in chunk above it's results
  message = TRUE, # if FALSE knitr won't display messages generated by code
  strip.white = TRUE, # if FALSE knitr won't remove white spaces at beg or end of code chunk
  warning = FALSE, # if FALSE knitr won't display warning messages in the doc
  error = TRUE) # report errors
  # options(tinytex.verbose = TRUE)
```

 \setcounter{section}{3}
 \setcounter{subsection}{2}
 \setcounter{subsubsection}{2}

#### Reading, Homeworks, Projects, SemProjects

  - Readings: 
    - For Today: OIS Chapter 4
    - For Next Class: EDA 1-31
  - Lab Exercises: 
    - LE2 given our Tuesday Sept. 13th
    - LE2 is due Thursday Sept. 22nd
  - Office Hours: (Class Canvas Calendar for Zoom Link) 
    - Wednesday @ 4:00 PM to 5:00 PM, Will Oltjen
    - Saturday @ 3:00 PM to 4:00 PM, Kristen Hernandez 
    - **Office Hours are on Zoom, and recorded**
  - Semester Projects
    - DSCI 451 Students Biweekly Update 1 Due 
    - DSCI 451 Students 
      - Next **Report Out #1 is Due Friday September 30th**
    - All DSCI 351/351M/451 Students: 
      - **Peer Grading of Report Out #1 is Due October 11th, 2022**
    - Exams
      - MidTerm: Tuesday October 18th, in class or remote, 11:30 - 12:45 PM
      - Final: Monday December 19, 2022, 12:00PM - 3:00PM, Nord 356 or remote

#### Textbooks

  - [Peng: R Programming for Data Science](https://leanpub.com/rprogramming)
  - [Peng: Exploratory Data Analysis with R](https://leanpub.com/exdata)
  - [Open Intro Stats, v3](https://openintro.org/os)
  - [Wickham: R for Data Science](https://r4ds.had.co.nz/)
  - [Hastie: Intro to Statistical Learning with R](https://www.statlearning.com/)
  
#### Syllabus

![DSCI351-351M-451 Syllabus](./figs/syllabus.png)

#### R Intro 2

##### Basics of R

```{r basicsofR}
#==================== 
# A pound symbol, or "Hashtag" indicates a comment in the code

# Basics of R
# Math operations
2 + 2
8 / 4
2 * 3
3 ^ 3
a <- 3
b <- 3
a + b

```

##### Assignment Operator

```{r assign-operator}
#====================
# Assignment operator is usually used instead of =
# It is directional
# = works in most cases too but may cause problems
# So we always use the <- Assignment operatore

a <- 3
b <- 6

a <- b
a

a <- 3
b <- 6

a -> b
a

```

##### Object Classes

```{r object-classes}
#====================
# Object classes
# numerics
a <- 5.5
class(a)
# integers
b <- as.integer(42)
class(b)
# logicals
c <- TRUE
class(c)
# characters
d <- "hello world"
class(d)
d
# factors
e <- as.factor(c("1", "1", "a", "1", "c", "a"))
class(e)
e

## quick note it you want to convert a factor to a numeric
## You have to convert it to a character first, then a numeric

```

##### Assigning Operators

```{r assign-operators2}
#====================
# Assigining Operators

## PRO TIP ## - Control enter runs the line you are on or a highlighted section

# Assign number
x <- 5

# Lets view it with function View()
View(x)

# We can also look into what view is as a function and how it works
?View() # The question command shows us the help file

# Assign a vector or array of numbers, from 1 - 5
x <- 1:5

# We can also use = instead of <- (supposeduly <- is better than =, not sure why)
# Assign a character string
B <- "hello"

# Use print function to print to console
print(B)
print(x)

```

##### Objects and Class Types

```{r classtypes}
#====================
# R Object and type of classes
# Characters, integers, numeric, complex, Logic (TRUE/FALSE)

# R Vectors
a <- c("hello", "wolrd")
A <- c("hi", 5)
c <- c(1.23452, 2.1435, 3.14)

# The function c() here is "concatenate" so it will combine the values
false <- TRUE

# These will have attributes such as dimensions, object class, and length

# Lets check all of the attributes
class(a)
class(A)
class(x)
class(c)
class(false)
false

# There are also factors - but we will dive into those later, they are categorical
# Oh and lists... probably the most dynamic object in R

# These classes are default by what R interprets them to be, but we can change them
c <- as.character(c)
class(c)

# Other class changing functions
as.numeric(x)
as.integer(x)
as.POSIXct(1442866615, origin = "1970-01-01") # A Date Format
as.factor(x)
as.list(x)
y <- as.data.frame(x) # An incredibly useful object

```

##### Checking the length of variables

```{r length}
#====================
# Lets check the lengths of the variables

length(a)
length(A)
length(x)
length(c)
length(false)

# Other nice functions to create objects, seq(), matrix(), vector(), array()
m <- seq(1, 24, by = 3)
m
n <- matrix(0, nrow = 3, ncol = 3)
print(n)

```

##### Looking at Dimensions

```{r dim}
#====================
# Lets look at the dimensions
dim(n)

# Lets also reset some of the variables
# The format for pulling values is [row, column]
n[2, 2] <- 2
print(n)

# We can be even more efficient, say all of column 1 is 3
n[, 1] <- 3
print(n)

# Next lets turn the matrix into a dataframe - this will allow multiple classes
n = as.data.frame(n)
n[1, 2] <- "character"
n[, 3] <- TRUE
print(n)
class(n)
class(n[, 1])
class(n[, 2])
class(n[, 3])

```

##### Binding rows and columns in a dataframe

```{r binding}
#====================
# Another useful tool is to bind datasets with rbind() and cbind()
a <- 1:5
b <- 20:24
rbind(a, b)
cbind(a, b)

d <- cbind(a, b)

# These must be of equal length along the dimension you wish to bind
# Same rows/same columns

```

#####  Other Useful Functions

```{r other}
#====================
# Other useful functions to mention, which(), mean(), sd(), min(), max()

row <- which(d[, 1] == 2) # Note the two equal signs that are necessary to check for equivalence
print(row)

mean(d)
sd(d)
min(d)
max(d)

```

#####  For and If statements

```{r for-if}
#====================
# For and IF statements, basic structure and example
# structure
for (i in 1:5) {
  # How much it should loop, and the values
  # Input what you want it to do
}

if (i == 5) {
  # Let it know what to check for
  # What you want to do if condition is met
}


# Example
length <- length(d[, 1])

for (i in 1:length) {
  d[i, 1] = 100
  
  if (i == 2) {
    d[i, 1] = 200
  }
  
}

print(d)

```

##### Writing and Reading data files

```{r datafiles}
#====================
# Writing and Reading data files

# Working directories
# Lets find where you are
getwd()

# Now we can set the directory we want, you must have R point to the directory
# that you either want to save to or read from
#setwd("path")

# PRO TIP the path . gives you the current, and .. gives you the one before
# Say I need to go two folders back and up one to data, I would enter
# setwd("../../data)
# Or if data was the next folder in from where I was setwd("./data)

# Set the working directory where you want
# setwd("./2-class")


# Lets write a .csv
write.csv(d, "d.csv")

# Now lets read it back in
e = read.csv("d.csv")

# Notice there are now rownames in the object
# You can avoid this with

write.csv(d, "d.csv", row.names = FALSE)
e = read.csv("./d.csv")

# Other ways to read in data
read.table("./d.csv", sep = ",")
#  read.delim("blah.txt", header = TRUE, sep = "\t") # For tab delimited files

```

#####  R Packages

```{r packages}
#====================
# Packages
# One of the coolest things in R is that it is open sourced and you can
# download new analysis techniques from many authors on the fly and incorporate
# it into your work

# There are two steps, install and library
#  install.packages("ggplot2")

library("ggplot2")

? ggplot2  # This allows us to check out the vignettes, or long form documentation

```

##### Using brackets to reference a data index

```{r data-index}
#====================
# R uses brackets to reference a data index
# data["row","column"]
# Standard organization for data set has variables as columns and observations as rows
# Keep in mind that R indexing starts from 1, not 0
# Load a test data set
data("iris")

iris[1, 2]

# Leaving a row or column input blank puts all values
# First column
iris[, 1]

# First row
iris[1, ]

# Data frames have associated column names
colnames(iris)

# Columns can be called by name using $
# Rstudio features tab completion for thing like column names
iris$Sepal.Length

```

#####  Functions

```{r functions2}
#====================
# Functions are processes that take an input and give an output
# Rstudio has tab completion for function inputs
max(iris$Petal.Length)
mean(iris$Sepal.Width)
sd(iris$Petal.Width)

# Functions can take multiple inputs, they can be named in the call or placed in order
plot(x = iris$Sepal.Length, y = iris$Sepal.Width)

# x and y can be specified with x = ... in any order or the inputs can be given in order
# This plot is the same as the previous
plot(iris$Sepal.Length, iris$Sepal.Width)

```

#####  Matrix Operations

```{r matrix}
#====================
# Matrix operations
mat <- matrix(data = 1:9,
              nrow = 3,
              ncol = 3)
mat

# Element multiplication
mat * mat

# Matrix multiplication
mat %*% mat

# t() function is for transposing
t(mat)
mat %*% t(mat)

# Inverse matrix
mat[2, 3] <- 18
solve(mat)
solve(mat) %*% mat

```

##### Looping structures in R: For and While loops

```{r loopswhile, message = FALSE}
#====================
# Structures in R
# for loops
for (i in 1:5) {
  print(i)
}

# While loops
i <- 10
while (i > 5) {
  i <- i - 1
  print(i)
}

# if statments
dave <- TRUE

# if (dave) {} also works
if (dave == TRUE) {
  print("good morning dave")
}

# User defined functions
math <- function(a, b) {
  c <- a + b * 2
  # return defines what the output of the function is
  return(c)
}
math(2, 6)

```

##### The Tidyverse

```{r tidyverse}
#====================
# In the past few years there has been much progress in developing
# The Tidyverse,  which focuses on Tidy Data Frames
# The packages involved include magrittr and dplyr
# which have streamlined call and code pipelines
# that specify and subset dataframes on the fly
```

#### Some Simple Rmd Items 

##### Rmd for Exploratory Data Analysis
 
  - EDA is a foundation of Data Science
  - Identify sources of data for your problem
  - Need to acquire, assemble, clean, and explore your data
  - An environment for Exploratory Data Analysis (EDA)  

##### R markdown is tool for Open Science

  - Reproducible data analysis
  - Incorporating Data, Code, Presentation and Reporting
  - Good coding practices are essential
  - Comment your code, describe your data frames
  - Make your data analyses a presentation and report.
   
##### R Code in Rmd is delineated 

  - three backticks for code blocks
  - one tick for inline code
 
##### YAML settings and commenting

  - This is the top block of the Rmd file
    - set off by three dashes ---
  - In the YAML Header, you can comment lines with ' #### '
    - But in the body, ' #### ' is a second level header!

##### Commenting in the Rmd body

  - To comment in the Rmd body, use html comment form
    - < ! - - Comment - - >  
    - but with no spaces between the characters
      - <!-- regular html comment --> 
      -  i.e.' <!-- ' starts a comment block  
      -  ''' --> ''' ends a comment block  

<!--
  So this is a comment block  
  
   In the YAML header its ####    (a bit confusing since this is a 2nd level header in the rest of the file)
         In the rest of the file its <!-- regular html comment -->
-->

##### Inserting Figs, 2 ways.

  ![Caption](./figs/markov.png)
  
  <center><img src="./figs/markov.png" height="150px" width="200px" />


#### Filenames and Paths  

  - Essential to use relative file paths
  - Essential to use Posix compatible paths

##### Filenames

  - No Spaces
  - No characters other than letters, numbers, - and underscore
  - Better not to capitalize
  - Or if you must, use CamelBacking

##### Paths

  - Windows is not Posix compatible
    - \ is not understood, must be typed \\
      - but should be /, 
    - / always works on Linux, Mac, Windows
  - Relative Paths
      - . i.e. dot, is the current folder
      - .. i.e. dot dot is the folder one above your current area
  - setwd (setting working directory) is bad to rely on.  

#### R Coding Training: For Loops

We will try to not use For Loops

  - Using the tidyverse 
  - An dpipes `%>%` is much more effective
  - An produces more readable code

##### For loop basics

  - For loops are an important part for almost any coding problem
  - They work by applying an iterator that changes every time 
    - i is the standard iterator over a code block
    - but the iterator can be named anything) 

##### Common example, using a counter 

```{r}
# print out numbers upto a given num
num <- 5

for (i in 1:num) {
  print(i)
}
```

##### Vectors or columns can also be iterated over

This can improve clarity in many cases 

  - if a counter is not needed

```{r interations}

letters <- c('a','b','c')

for (i in letters) {
  print(i)
}
```

##### Collecting for loop outputs

Lets say we want to calculate the square root of every value in a vector 

  - using a for loop, 
  - what is the problem with the code below?

```{r loop-outputs}

num <- c(4, 8, 15, 16, 23, 42)

for (i in num) {
  result <- sqrt(i)
}

result
```

We only get 1 number when we wanted 6

  - Every time the loop iterates it overwrites the 'result' variable, 
    - leaving us with only the last value
  - There are multiple was to save out results, 
    - depending on what analysis you're running
  - I've found this to be one of the most straight forward ways

```{rloop-outputs2}

num <- c(4, 8, 15, 16, 23, 42)
# define a NULL variable to write into
all_results <- NULL

for (i in num) {
  # calculate the square root of i
  result <- sqrt(i)
  # concatinate the ith result onto the total result vector 
  # rbind() is also useful if the results have multiple variables (columns)
  all_results <- c(all_results, result)
}

all_results
```

- This gives us the answer we wanted

##### For loop drawbacks

For loops are highly fundamental 

  - But they have some problems
  - As seen in the example above, 
    - organizing results can be messy, 
    - especially with complicated results
  - They only run one process at a time, 
    - making them slow and 
    - unable to run parallel process
  - Later on we will look at ways to avoid for loops 
    - to improve code clarity and increase speed, 
    - as well as allow for parallel processing
    
Dplyr, Pipes and the Tidyverse

  - Help avoid the slow performance of For loops
  - And streamline/clarify the code


#### Links
 
http://www.r-project.org 

http://rmarkdown.rstudio.com/  

<!--
# Keep a complete change log history at bottom of file.
# Complete Change Log History
# v0.00.00 - 1405-07 - Nick Wheeler made the blank script
##########


