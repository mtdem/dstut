---
title: "DSCI353-353m-453: Class 14a Mapping Google Trends data For Thanksgiving"
subtitle: "2008-351-351m-451-W14a-p2-GIS-Gtrends-Thnksgvng-Maps"
author: "Roger H. French, Raymond Weiser, Sameera Nalin Venkat" 
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  pdf_document:
    latex_engine: xelatex
    toc: TRUE
    number_sections: TRUE
    toc_depth: 6
    highlight: tango
  html_notebook:
  html_document:
    css: ../lab.css
    highlight: pygments
    theme: cerulean
    toc: yes
    toc_depth: 6
    toc_float: yes
    df_print: paged
urlcolor: blue
always_allow_html: true
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  cache = FALSE, # if TRUE knitr will cache results to reuse in future knits
  fig.width = 6, # the width for plots created by code chunk
  fig.height = 4, # the height for plots created by code chunk
  fig.align = 'center', # how to align graphics. 'left', 'right', 'center'
  dpi = 300, 
  dev = 'png', # Makes each fig a png, and avoids plotting every data point
  # eval = FALSE, # if FALSE, then the R code chunks are not evaluated
  # results = 'asis', # knitr passes through results without reformatting
  echo = TRUE, # if FALSE knitr won't display code in chunk above it's results
  message = TRUE, # if FALSE knitr won't display messages generated by code
  strip.white = TRUE, # if FALSE knitr won't remove white spaces at beg or end of code chunk
  warning = TRUE, # if FALSE knitr won't display warning messages in the doc
  error = TRUE) # report errors
  # options(tinytex.verbose = TRUE)
```

 \setcounter{section}{14}
 \setcounter{subsection}{1}
 \setcounter{subsubsection}{3}

### Mapping Google Trends data For Thanksgiving

Lets use the R package `usmap` 

  - which enables incredibly easy and fast 
    - creation of US maps in R.  

In honor of US Thanksgiving, 

  - we'll use the `gtrendsR` package 
    - to pull US Google search results 
      - on the keyword "thanksgiving‚Äù 
    - and plot the popularity by state.  

#### Install and Load Packages

```{r}
library(gtrendsR)
library(tidyverse)
library(cdlTools)
library(usmap)


#Set a color
orange <- "#C9592E"
```

#### Use Google Trends to get thanksgiving trends

- Use the [gTrendsR Package](https://cran.r-project.org/web/packages/gtrendsR/gtrendsR.pdf) 

  - to get the query trends for thanksgiving in the US 
  - for the past 24 hours

```{r}
thanksgiving <-
  gtrendsR::gtrends(keyword = "thanksgiving", geo = "US", time = "now 1-d") # last day

glimpse(thanksgiving)
```


```{r}
thanksgiving_2021 <-
  gtrends(keyword = "thanksgiving", geo = "US", time = "2021-11-23 2021-11-25", tz = 0 ) # last year

glimpse(thanksgiving_2021)
```


```{r}
thanksgiving_2020 <-
  gtrends(keyword = "thanksgiving", geo = "US", time = "2020-11-26 2020-11-27") # 2nd year

glimpse(thanksgiving_2020)
```

#### Gather Interest by State

- Select the data frame 

  - for interest by state and 
    - then convert the names of the states to FIPS codes 
    - FIPS codes are 
      - 2 characters for state, 
      - 5 characters for county

The `usmap` package 

  - requires the data in FIPS format.

To gather the FIPS data, 

  - use the `usmap::fips()` function 
    - to convert state name to code
    - [fips function reference](https://www.rdocumentation.org/packages/cdlTools/versions/0.14/topics/fips)
    
```{r }
thanksgivingStates <- thanksgiving$interest_by_region

thanksgivingStates$fips <- fips(thanksgivingStates$location)
glimpse(thanksgivingStates$fips)

thanksgivingStates_2021 <- thanksgiving_2021$interest_by_region

thanksgivingStates_2021$fips <- fips(thanksgivingStates_2021$location)

thanksgivingStates_2020 <- thanksgiving_2020$interest_by_region

thanksgivingStates_2020$fips <- fips(thanksgivingStates_2020$location)
```

#### Plot interest with the US Map by state

- Create a US heatmap 

  - with google search popularity 
    - for the keyword "thanksgiving"

```{r }
plot_usmap(
  data = thanksgivingStates,
  values = "hits",
  color = orange,
  labels = TRUE
) +
  scale_fill_continuous(
    low = "white",
    high = orange,
    name = "Popularity",
    label = scales::comma
  ) +
  theme(legend.position = "right") +
  theme(panel.background = element_rect(colour = "black")) +
  labs(title = "Popularity of Thanksgiving this Year, Google Search by State", caption = "Source: @littlemissdata") 
```

And for last year, 2020?

```{r }
plot_usmap(
  data = thanksgivingStates_2021,
  values = "hits",
  color = orange,
  labels = TRUE
) +
  scale_fill_continuous(
    low = "white",
    high = orange,
    name = "Popularity",
    label = scales::comma
  ) +
  theme(legend.position = "right") +
  theme(panel.background = element_rect(colour = "black")) +
  labs(title = "Popularity of Thanksgiving 2021, Google Search by State", caption = "Source: @littlemissdata") 
```

And for two years ago, 2020?

```{r }
plot_usmap(
  data = thanksgivingStates_2020,
  values = "hits",
  color = orange,
  labels = TRUE
) +
  scale_fill_continuous(
    low = "white",
    high = orange,
    name = "Popularity",
    label = scales::comma
  ) +
  theme(legend.position = "right") +
  theme(panel.background = element_rect(colour = "black")) +
  labs(title = "Popularity of Thanksgiving in 2020, Google Search by State", caption = "Source: @littlemissdata") 
```

We can clearly see from the graphs above, 

  - differences between two years ago, last year and now. 
    - about how excited people were for thanksgiving 
  - Lets look at the east coast
    - Now and Last Year at this time


#### Plot East Coast interest with the US Map by state

- Drill in on the seemingly most popular regions 

  - using the "include" parameter 
    - in the plot_usmap() function.  

Regional divisions can be found in the docs [here](https://cran.r-project.org/web/packages/usmap/usmap.pdf)

For this year

```{r }
plot_usmap(
  data = thanksgivingStates,
  values = "hits",
  include =  c(.south_atlantic, .east_north_central),
  color = orange,
  labels = TRUE
) +
  scale_fill_continuous(
    low = "white",
    high = orange,
    name = "Popularity",
    label = scales::comma
  ) +
  theme(legend.position = "right") +
  theme(panel.background = element_rect(colour = "black")) +
  labs(title = "US East Coast Popularity of Thanksgiving 2021 Google Search", caption = "Source: @littlemissdata") 
```

And last year, 2021.

```{r }
plot_usmap(
  data = thanksgivingStates_2021,
  values = "hits",
  include =  c(.south_atlantic, .east_north_central),
  color = orange,
  labels = TRUE
) +
  scale_fill_continuous(
    low = "white",
    high = orange,
    name = "Popularity",
    label = scales::comma
  ) +
  theme(legend.position = "right") +
  theme(panel.background = element_rect(colour = "black")) +
  labs(title = "US East Coast Popularity of Thanksgiving 2021 Google Search", caption = "Source: @littlemissdata") 
```

And two years ago, 2020.

```{r }
plot_usmap(
  data = thanksgivingStates_2020,
  values = "hits",
  include =  c(.south_atlantic, .east_north_central),
  color = orange,
  labels = TRUE
) +
  scale_fill_continuous(
    low = "white",
    high = orange,
    name = "Popularity",
    label = scales::comma
  ) +
  theme(legend.position = "right") +
  theme(panel.background = element_rect(colour = "black")) +
  labs(title = "US East Coast Popularity of Thanksgiving 2020 Google Search", caption = "Source: @littlemissdata") 
```

### Links

Laura Ellis, "Easy US Maps in R - Thanksgiving Edition", 11/27/2019
  - [https://www.littlemissdata.com/blog/usmap](https://www.littlemissdata.com/blog/usmap)

 
